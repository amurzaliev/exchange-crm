{% extends "profile.layout.html.twig" %}
{% block content %}

    <section class="content-header">
        <h1>
            Управление персоналом
            <small>Список</small>
        </h1>
        <ol class="breadcrumb">
            <li><a href="#"><i class="fa fa-dashboard"></i> Главная</a></li>
        </ol>
    </section>

    <!-- Main content -->
    <section class="content">
        <div class="row">
            <div class="col-xs-12">
                <div class="box">
                    {% if is_granted('ROLE_ADMIN') or is_granted('ROLE_OWNER') %}
                        <div class="box-header">
                            <h3 class="box-title">
                                <a href="#" class="btn btn-block btn-success btn-lg"
                                   data-toggle="modal" data-target="#add-staff">
                                    Добавить
                                </a>
                            </h3>
                        </div>
                    {% endif %}
                    <!-- Modal -->
                    <div class="form-staff">
                        {{ include('profile/components/forms/modal_form_staff.html.twig', {'permissionGroups':permissionGroups}) }}
                    </div>
                    <!-- /.box-header -->
                    <div class="box-body">
                        <table id="example2" class="table table-bordered table-hover">
                            <thead>
                            <tr>
                                <th>#id</th>
                                <th>Ф.И.О</th>
                                <th>Login</th>
                                <th>Должность</th>
                                <th>Дата создания</th>
                                <th>Дата изменения</th>
                                <th>Действние</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for staff in staffs %}
                                <tr>
                                    <td>{{ staff.user.id }}</td>
                                    <td>{{ staff.user.fullName }}</td>
                                    <td>{{ staff.user.username }}</td>
                                    <td>{{ staff.position }}</td>
                                    <td>{{ staff.createdAt.format("d-m-Y H:i:s") }}</td>
                                    <td>{{ staff.updatedAt.format("d-m-Y H:i:s") }}</td>
                                    <td>
                                        <a href="{{ path('profile_staff_detail', {'id' : staff.user.id }) }}"
                                           class="btn btn-default" title="Просмотреть запись {{ staff.user.fullName }}">Просмотр
                                            <i class="fa fa-fw fa-eye"></i></a>
                                        {% if is_granted('ROLE_ADMIN') or is_granted('ROLE_OWNER') %}
                                            <a href="{{ path('profile_staff_edit', {'id' : staff.user.id }) }}"
                                               class="btn btn-primary"
                                               title="Редактировать запись {{ staff.user.fullName }}"> Редактировать <i
                                                        class="fa fa-fw fa-pencil"></i></a>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td>Нет данных</td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <!-- /.box-body -->
                </div>
                <!-- /.box -->

            </div>
            <!-- /.col -->
        </div>
        <!-- /.row -->
    </section>

{% endblock %}

{% block Javascript %}
    <script>
        $(document).ready(function () {

           $('.submit-staff-btn').on('click', function () {
              var fullname = $('#fullname').val();
              var username = $('#username').val();
              var password = $('#password').val();
              var enabled = $('#enabled').prop('checked');
              var group = $('#group').val();
              var position = $('#position').val();


              var data = {
                  fullname:fullname,
                  username:username,
                  password:password,
                  enabled:enabled,
                  group:group,
                  position:position
              };

              $.post('{{ path('profile_staff_create_ajax') }}', data, function (response) {
                  console.log(response);
              }, 'json');
           });


        });



    </script>

{% endblock %}